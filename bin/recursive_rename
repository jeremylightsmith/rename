#!/usr/bin/ruby

require File.dirname(__FILE__) + '/common'

def recursive_rename(dir, find, replace, test_run)
    rename(dir, find, replace, test_run)
    Dir.foreach(dir) do |name|
	child_dir = "#{dir}/#{name}"
	if name != '.' && name != '..' && File.lstat(child_dir).directory?
	    recursive_rename(child_dir, find, replace, test_run)
	end
    end    
end

find = Regexp.new(ARGV[0]) if ARGV[0]
replace = ARGV[1]

if !find or !replace
    puts 'usage: recursive_rename <find> <replace>'

else
    puts "renaming #{find} to #{replace}"
    recursive_rename '.', find, replace, true
    recursive_rename '.', find, replace, false if ask "do it for real? [y/n]"
end